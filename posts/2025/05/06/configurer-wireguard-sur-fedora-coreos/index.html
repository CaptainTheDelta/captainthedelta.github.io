<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Configurer WireGuard sur Fedora CoreOS | Bouffre !</title>
<meta name=keywords content="wireguard,fedora,serveur,sysadmin"><meta name=description content="Protéger son accès à internet, accéder à son réseau local depuis l'extérieur, filtrer les pubs... plusieurs bonnes choses qu'on peut faire via WireGuard"><meta name=author content="Damien"><link rel=canonical href=https://bouffre.fr/posts/2025/05/06/configurer-wireguard-sur-fedora-coreos/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://bouffre.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bouffre.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bouffre.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://bouffre.fr/apple-touch-icon.png><link rel=mask-icon href=https://bouffre.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://bouffre.fr/posts/2025/05/06/configurer-wireguard-sur-fedora-coreos/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://bouffre.fr/posts/2025/05/06/configurer-wireguard-sur-fedora-coreos/"><meta property="og:site_name" content="Bouffre !"><meta property="og:title" content="Configurer WireGuard sur Fedora CoreOS"><meta property="og:description" content="Protéger son accès à internet, accéder à son réseau local depuis l'extérieur, filtrer les pubs... plusieurs bonnes choses qu'on peut faire via WireGuard"><meta property="og:locale" content="fr-fr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-06T15:58:26+00:00"><meta property="article:modified_time" content="2025-05-06T15:58:26+00:00"><meta property="article:tag" content="Wireguard"><meta property="article:tag" content="Fedora"><meta property="article:tag" content="Serveur"><meta property="article:tag" content="Sysadmin"><meta name=twitter:card content="summary"><meta name=twitter:title content="Configurer WireGuard sur Fedora CoreOS"><meta name=twitter:description content="Protéger son accès à internet, accéder à son réseau local depuis l'extérieur, filtrer les pubs... plusieurs bonnes choses qu'on peut faire via WireGuard"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bouffre.fr/posts/"},{"@type":"ListItem","position":2,"name":"Configurer WireGuard sur Fedora CoreOS","item":"https://bouffre.fr/posts/2025/05/06/configurer-wireguard-sur-fedora-coreos/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Configurer WireGuard sur Fedora CoreOS","name":"Configurer WireGuard sur Fedora CoreOS","description":"Protéger son accès à internet, accéder à son réseau local depuis l'extérieur, filtrer les pubs... plusieurs bonnes choses qu'on peut faire via WireGuard","keywords":["wireguard","fedora","serveur","sysadmin"],"articleBody":"Au menu d’aujourd’hui :\nInstaller WireGuard ; Faire et comprendre sa première configuration ; Accéder à l’internet mondial via WireGuard ; Rendre le tout persistant ; Bonus : fournir un DNS bloqueur de pub. Installer WireGuard la doc\nsudo dnf install wireguard-tools Première config la dooc Avec WireGuard, nous allons venir créer une nouvelle interface réseau (un peu comme une interface ethernet ou wifi). Pour chaque appareil, nous aurons besoin d’une clef privée et d’une clef publique.\nOn les génère comme suit :\numask 077 wg genkey \u003e privatekey wg pubkey \u003c privatekey \u003e publickey umask permet de fixer les permissions du fichier créé à la prochaine commande exécutée ; \u003e permet de rediriger les sorties de programme dans un fichier ; \u003c fait l’inverse : il lit le fichier donné pour le passer en argument de la commande exécutée. Ou bien en une seule ligne :\nwg genkey | tee privatekey | wg pubkey \u003e publickey | permet de passer le contenu de la sortie à la commande d’après ; tee écrit le contenu dans le fichier privatekey et dans la sortie standard. Config du serveur L’interface que nous allons créer aura le nom de wg0, on crée donc le fichier /etc/wireguard/wg0.conf qu’on remplit avec :\n[Interface] PrivateKey = clef_privée_serveur Address = 10.0.0.1 ListenPort = 51820 # Premier appareil [Peer] PublicKey = clef_publique_peer AllowedIps = 10.0.0.2/32 Points clefs à retenir :\nAddress correspond à l’adresse IP du serveur sur le réseau wg0. AllowedIps correspond au trafic qui sera redirigé depuis le serveur vers le peer. Config d’un appareil distant Sur le client :\n[Interface] PrivateKey = clef_privee_client Address = 10.0.0.2/32 DNS = 1.1.1.1 [Peer] PublicKey = clef_publique_serveur AllowedIPs = 0.0.0.0/0, ::/0 Endpoint = 192.168.0.162:51820 PersistentKeepalive = 25 Points clefs à retenir :\nAddress correspond à l’adresse IP du client sur le réseau wg0. AllowedIps correspond au trafic qui sera redirigé depuis le peer vers le serveur, ici on demande la totalité. Endpoint correspond à l’adresse IP du serveur (avec le port en bonus) sur le réseau habituel. Cela peut également être un nom de domaine. Accès à Internet [!warning] Attention Ceci est un risque potentiel de sécurité ! Pensez à paramétrer votre pare-feu.\nPour accéder à l’internet mondial, il faut autoriser le serveur à faire du net forwarding.\nNet forwarding Prenons une image. Depuis une ville A, nous écrivons à Bob qui est dans la ville B. Nous indiquons sur l’enveloppe l’adresse de Bob. Les services postaux vont chercher à délivrer le courrier Bob… dans la ville A. Il ne sera jamais délivré, et nous n’obtiendrons jamais sa réponse. Il faut autoriser le courrier à voyager entre les villes A et B pour obtenir notre réponse. Une fois l’autorisation donnée, si les services postaux ne trouvent pas Bob dans la ville A, ils le chercheront dans la ville B.\nSans l’image, il faut autoriser les interfaces réseau à communiquer entre elles.\nsudo sysctl -w net.ipv4.ip_forward=1 sudo sysctl -w net.ipv6.conf.all.forwarding=1 Network Forwarding Table Une autre doc Maintenant que le net forwarding est autorisé, il n’y a plus qu’à le configurer pour l’IPv4 :\nnft add table ip wireguard nft add chain ip wireguard wireguard_chain {type nat hook postrouting priority srcnat; policy accept;} nft add rule ip wireguard wireguard_chain counter packets 0 bytes 0 masquerade Et pour l’IPv6 :\nnft add table ip6 wireguard nft add chain ip6 wireguard wireguard_chain {type nat hook postrouting priority srcnat; policy accept;} nft add rule ip6 wireguard wireguard_chain counter packets 0 bytes 0 masquerade Persistence C’est bien rigolo tout ça, mais ce n’est pas persistant. Trois choses à gérer :\nle lancement de WireGuard ; L’autorisation du net forwarding ; La création des règles de forwarding. systemctl sudo systemctl start wg-quick@wg0 sudo systemctl enable wg-quick@wg0 Donc, on va faire en sorte que ça le devienne : pour le forwarding la doc de RedHat et pour NFT.\nOn vient créer /etc/sysctl.d/95-wg-ipforwarding.conf\nnet.ipv4.ip_forward = 1 net.ipv6.conf.all.forwarding = 1 Ce fichier sera exécuté à chaque démarrage du serveur.\nPour le reste, on vient ajouter dans le fichier de configuration du serveur ces deux lignes, dans la section [Interface] :\nPostUp = nft add table ip wireguard; nft add chain ip wireguard wireguard_chain {type nat hook postrouting priority srcnat; policy accept;}; nft add rule ip wireguard wireguard_chain counter packets 0 bytes 0 masquerade; nft add table ip6 wireguard; nft add chain ip6 wireguard wireguard_chain {type nat hook postrouting priority srcnat; policy accept;}; nft add rule ip6 wireguard wireguard_chain counter packets 0 bytes 0 masquerade PostDown = nft delete table ip wireguard; nft delete table ip6 wireguard Bloquer les pubs Pour bloquer (en partie) les pubs, on peut paramétrer le serveur DNS qui les filtre pour nous. Merci AdGuard pour tes DNS !\nRendez-vous sur leur site, dépliez “Les adresses de nos serveurs” puis “DNS brut”, et faites votre choix !\nDans la section Interface de la configuration client, vous pouvez renseigner le serveur DNS qui vous arrange.\n[Interface] DNS = 94.140.14.15 ","wordCount":"822","inLanguage":"en","datePublished":"2025-05-06T15:58:26Z","dateModified":"2025-05-06T15:58:26Z","author":{"@type":"Person","name":"Damien"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bouffre.fr/posts/2025/05/06/configurer-wireguard-sur-fedora-coreos/"},"publisher":{"@type":"Organization","name":"Bouffre !","logo":{"@type":"ImageObject","url":"https://bouffre.fr/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bouffre.fr/ accesskey=h title="Bouffre ! (Alt + H)">Bouffre !</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Configurer WireGuard sur Fedora CoreOS</h1><div class=post-description>Protéger son accès à internet, accéder à son réseau local depuis l'extérieur, filtrer les pubs... plusieurs bonnes choses qu'on peut faire via WireGuard</div><div class=post-meta><span title='2025-05-06 15:58:26 +0000 UTC'>May 6, 2025</span>&nbsp;·&nbsp;Damien</div></header><div class=post-content><p>Au menu d&rsquo;aujourd&rsquo;hui :</p><ol><li>Installer WireGuard ;</li><li>Faire et comprendre sa première configuration ;</li><li>Accéder à l&rsquo;internet mondial via WireGuard ;</li><li>Rendre le tout persistant ;</li><li>Bonus : fournir un DNS bloqueur de pub.</li></ol><h2 id=installer-wireguard>Installer WireGuard<a hidden class=anchor aria-hidden=true href=#installer-wireguard>#</a></h2><p><a href=https://www.wireguard.com/install/>la doc</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dnf install wireguard-tools
</span></span></code></pre></div><h2 id=première-config>Première config<a hidden class=anchor aria-hidden=true href=#première-config>#</a></h2><p><a href=https://www.wireguard.com/quickstart/>la dooc</a>
Avec WireGuard, nous allons venir créer une nouvelle interface réseau (un peu comme une interface ethernet ou wifi).
Pour chaque appareil, nous aurons besoin d&rsquo;une clef privée et d&rsquo;une clef publique.</p><p>On les génère comme suit :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>umask <span style=color:#ae81ff>077</span>
</span></span><span style=display:flex><span>wg genkey &gt; privatekey
</span></span><span style=display:flex><span>wg pubkey &lt; privatekey &gt; publickey
</span></span></code></pre></div><ul><li><code>umask</code> permet de fixer les permissions du fichier créé à la prochaine commande exécutée ;</li><li><code>></code> permet de rediriger les sorties de programme dans un fichier ;</li><li><code>&lt;</code> fait l&rsquo;inverse : il lit le fichier donné pour le passer en argument de la commande exécutée.</li></ul><p>Ou bien en une seule ligne :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wg genkey | tee privatekey | wg pubkey &gt; publickey
</span></span></code></pre></div><ul><li><code>|</code> permet de passer le contenu de la sortie à la commande d&rsquo;après ;</li><li><code>tee</code> écrit le contenu dans le fichier <code>privatekey</code> et dans la sortie standard.</li></ul><h3 id=config-du-serveur>Config du serveur<a hidden class=anchor aria-hidden=true href=#config-du-serveur>#</a></h3><p>L&rsquo;interface que nous allons créer aura le nom de <code>wg0</code>, on crée donc le fichier <code>/etc/wireguard/wg0.conf</code> qu&rsquo;on remplit avec :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>Interface</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>PrivateKey</span> = <span style=color:#a6e22e>clef_priv</span><span style=color:#960050;background-color:#1e0010>é</span><span style=color:#a6e22e>e_serveur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Address</span> = <span style=color:#ae81ff>10.0</span>.<span style=color:#ae81ff>0.1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ListenPort</span> = <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Premier appareil</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>Peer</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>PublicKey</span> = <span style=color:#a6e22e>clef_publique_peer</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>AllowedIps</span> = <span style=color:#ae81ff>10.0</span>.<span style=color:#ae81ff>0.2</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#ae81ff>32</span>
</span></span></code></pre></div><p>Points clefs à retenir :</p><ul><li><code>Address</code> correspond à l&rsquo;adresse IP du serveur sur le réseau <code>wg0</code>.</li><li><code>AllowedIps</code> correspond au trafic qui sera redirigé depuis le serveur vers le peer.</li></ul><h3 id=config-dun-appareil-distant>Config d&rsquo;un appareil distant<a hidden class=anchor aria-hidden=true href=#config-dun-appareil-distant>#</a></h3><p>Sur le client :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>Interface</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>PrivateKey</span> = <span style=color:#a6e22e>clef_privee_client</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Address</span> = <span style=color:#ae81ff>10.0</span>.<span style=color:#ae81ff>0.2</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DNS</span> = <span style=color:#ae81ff>1.1</span>.<span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>Peer</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>PublicKey</span> = <span style=color:#a6e22e>clef_publique_serveur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>AllowedIPs</span> = <span style=color:#ae81ff>0.0</span>.<span style=color:#ae81ff>0.0</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#ae81ff>0</span>, <span style=color:#960050;background-color:#1e0010>::/</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Endpoint</span> = <span style=color:#ae81ff>192.168</span>.<span style=color:#ae81ff>0.162</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>PersistentKeepalive</span> = <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><p>Points clefs à retenir :</p><ul><li><code>Address</code> correspond à l&rsquo;adresse IP du client sur le réseau <code>wg0</code>.</li><li><code>AllowedIps</code> correspond au trafic qui sera redirigé depuis le peer vers le serveur, ici on demande la totalité.</li><li><code>Endpoint</code> correspond à l&rsquo;adresse IP du serveur (avec le port en bonus) sur le réseau habituel. Cela peut également être un nom de domaine.</li></ul><h2 id=accès-à-internet>Accès à Internet<a hidden class=anchor aria-hidden=true href=#accès-à-internet>#</a></h2><blockquote><p>[!warning] Attention
Ceci est un risque potentiel de sécurité ! Pensez à paramétrer votre pare-feu.</p></blockquote><p>Pour accéder à l&rsquo;internet mondial, il faut autoriser le serveur à faire du net forwarding.</p><h3 id=net-forwarding>Net forwarding<a hidden class=anchor aria-hidden=true href=#net-forwarding>#</a></h3><p>Prenons une image.
Depuis une ville A, nous écrivons à Bob qui est dans la ville B. Nous indiquons sur l&rsquo;enveloppe l&rsquo;adresse de Bob. Les services postaux vont chercher à délivrer le courrier Bob&mldr; dans la ville A. Il ne sera jamais délivré, et nous n&rsquo;obtiendrons jamais sa réponse.
Il faut autoriser le courrier à voyager entre les villes A et B pour obtenir notre réponse.
Une fois l&rsquo;autorisation donnée, si les services postaux ne trouvent pas Bob dans la ville A, ils le chercheront dans la ville B.</p><p>Sans l&rsquo;image, il faut autoriser les interfaces réseau à communiquer entre elles.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo sysctl -w net.ipv4.ip_forward<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>sudo sysctl -w net.ipv6.conf.all.forwarding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=network-forwarding-table>Network Forwarding Table<a hidden class=anchor aria-hidden=true href=#network-forwarding-table>#</a></h3><p>Une <a href=https://docs.pi-hole.net/guides/vpn/wireguard/internal/>autre doc</a>
Maintenant que le net forwarding est autorisé, il n&rsquo;y a plus qu&rsquo;à le configurer pour l&rsquo;IPv4 :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nft add table ip wireguard
</span></span><span style=display:flex><span>nft add chain ip wireguard wireguard_chain <span style=color:#f92672>{</span>type nat hook postrouting priority srcnat; policy accept;<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nft add rule ip wireguard wireguard_chain counter packets <span style=color:#ae81ff>0</span> bytes <span style=color:#ae81ff>0</span> masquerade
</span></span></code></pre></div><p>Et pour l&rsquo;IPv6 :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nft add table ip6 wireguard
</span></span><span style=display:flex><span>nft add chain ip6 wireguard wireguard_chain <span style=color:#f92672>{</span>type nat hook postrouting priority srcnat; policy accept;<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nft add rule ip6 wireguard wireguard_chain counter packets <span style=color:#ae81ff>0</span> bytes <span style=color:#ae81ff>0</span> masquerade  
</span></span></code></pre></div><h2 id=persistence>Persistence<a hidden class=anchor aria-hidden=true href=#persistence>#</a></h2><p>C&rsquo;est bien rigolo tout ça, mais ce n&rsquo;est pas persistant.
Trois choses à gérer :</p><ol><li>le lancement de WireGuard ;</li><li>L&rsquo;autorisation du net forwarding ;</li><li>La création des règles de forwarding.</li></ol><h3 id=systemctl>systemctl<a hidden class=anchor aria-hidden=true href=#systemctl>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start wg-quick@wg0
</span></span><span style=display:flex><span>sudo systemctl enable wg-quick@wg0
</span></span></code></pre></div><p>Donc, on va faire en sorte que ça le devienne : pour le forwarding <a href=https://docs.redhat.com/fr/documentation/red_hat_enterprise_linux/9/html/managing_monitoring_and_updating_the_kernel/using-configuration-files-in-etc-sysctl-d-to-adjust-kernel-parameters_configuring-kernel-parameters-at-runtime#using-configuration-files-in-etc-sysctl-d-to-adjust-kernel-parameters_configuring-kernel-parameters-at-runtime>la doc de RedHat</a> et pour NFT.</p><p>On vient créer <code>/etc/sysctl.d/95-wg-ipforwarding.conf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>ipv4</span>.<span style=color:#a6e22e>ip_forward</span> = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>ipv6</span>.<span style=color:#a6e22e>conf</span>.<span style=color:#a6e22e>all</span>.<span style=color:#a6e22e>forwarding</span> = <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Ce fichier sera exécuté à chaque démarrage du serveur.</p><p>Pour le reste, on vient ajouter dans le fichier de configuration du serveur ces deux lignes, dans la section <code>[Interface]</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>PostUp</span> = <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>table</span> <span style=color:#a6e22e>ip</span> <span style=color:#a6e22e>wireguard</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>chain</span> <span style=color:#a6e22e>ip</span> <span style=color:#a6e22e>wireguard</span> <span style=color:#a6e22e>wireguard_chain</span> {<span style=color:#a6e22e>type</span> <span style=color:#a6e22e>nat</span> <span style=color:#a6e22e>hook</span> <span style=color:#a6e22e>postrouting</span> <span style=color:#a6e22e>priority</span> <span style=color:#a6e22e>srcnat</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>policy</span> <span style=color:#a6e22e>accept</span><span style=color:#960050;background-color:#1e0010>;</span>}<span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>rule</span> <span style=color:#a6e22e>ip</span> <span style=color:#a6e22e>wireguard</span> <span style=color:#a6e22e>wireguard_chain</span> <span style=color:#a6e22e>counter</span> <span style=color:#a6e22e>packets</span> <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>bytes</span> <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>masquerade</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>table</span> <span style=color:#a6e22e>ip6</span> <span style=color:#a6e22e>wireguard</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>chain</span> <span style=color:#a6e22e>ip6</span> <span style=color:#a6e22e>wireguard</span> <span style=color:#a6e22e>wireguard_chain</span> {<span style=color:#a6e22e>type</span> <span style=color:#a6e22e>nat</span> <span style=color:#a6e22e>hook</span> <span style=color:#a6e22e>postrouting</span> <span style=color:#a6e22e>priority</span> <span style=color:#a6e22e>srcnat</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>policy</span> <span style=color:#a6e22e>accept</span><span style=color:#960050;background-color:#1e0010>;</span>}<span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>rule</span> <span style=color:#a6e22e>ip6</span> <span style=color:#a6e22e>wireguard</span> <span style=color:#a6e22e>wireguard_chain</span> <span style=color:#a6e22e>counter</span> <span style=color:#a6e22e>packets</span> <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>bytes</span> <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>masquerade</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>PostDown</span> = <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>delete</span> <span style=color:#a6e22e>table</span> <span style=color:#a6e22e>ip</span> <span style=color:#a6e22e>wireguard</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#a6e22e>nft</span> <span style=color:#a6e22e>delete</span> <span style=color:#a6e22e>table</span> <span style=color:#a6e22e>ip6</span> <span style=color:#a6e22e>wireguard</span>
</span></span></code></pre></div><h2 id=bloquer-les-pubs>Bloquer les pubs<a hidden class=anchor aria-hidden=true href=#bloquer-les-pubs>#</a></h2><p>Pour bloquer (en partie) les pubs, on peut paramétrer le serveur DNS qui les filtre pour nous.
Merci AdGuard pour tes DNS !</p><p>Rendez-vous sur leur <a href=https://adguard-dns.io/fr/public-dns.html>site</a>, dépliez &ldquo;Les adresses de nos serveurs&rdquo; puis &ldquo;DNS brut&rdquo;, et faites votre choix !</p><p>Dans la section Interface de la configuration client, vous pouvez renseigner le serveur DNS qui vous arrange.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>Interface</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>DNS</span> = <span style=color:#ae81ff>94.140</span>.<span style=color:#ae81ff>14.15</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://bouffre.fr/tags/wireguard/>Wireguard</a></li><li><a href=https://bouffre.fr/tags/fedora/>Fedora</a></li><li><a href=https://bouffre.fr/tags/serveur/>Serveur</a></li><li><a href=https://bouffre.fr/tags/sysadmin/>Sysadmin</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://bouffre.fr/>Bouffre !</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>